<!DOCTYPE html>
<html>

<head>
</head>
<!-- Origin Trial Token, feature = WebXR Device API, origin = https://acossack.github.io, expires = 2019-08-16 -->
<meta http-equiv="origin-trial" data-feature="WebXR Device API" data-expires="2019-08-16" content="AvXi+ZLENrqNfE9kA+h4NxnrYDUw9HX5w+SO3WMOdMJe8OET4IiQNzMXUyITqX5qEKSA2o6hCll/WycT1Oq25gIAAABaeyJvcmlnaW4iOiJodHRwczovL2Fjb3NzYWNrLmdpdGh1Yi5pbzo0NDMiLCJmZWF0dXJlIjoiV2ViWFJEZXZpY2VNNzYiLCJleHBpcnkiOjE1NjU5NDU3NDl9">

<script src="https://threejs.org/build/three.min.js"></script>
<script src="https://threejs.org/examples/js/vr/HelioWebXRPolyfill.js"></script>
<script src="https://threejs.org/examples/js/vr/WebVR.js"></script>
<script src="https://threejs.org/examples/js/loaders/GLTFLoader.js"></script>

<body>
	<script>
		var scene = new THREE.Scene();
		scene.background = new THREE.Color(0x505050);


// 		var camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 10);
// 		scene.add(camera);


var user = new THREE.Group();
user.position.set(0,0,0);
camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.1, 1000 );
camera.position.y = 1.6;
user.add( camera );
scene.add(user);

		var crosshair = new THREE.Mesh(
			new THREE.RingBufferGeometry(0.02, 0.04, 32),
			new THREE.MeshBasicMaterial({
				color: 0xffffff,
				opacity: 0.5,
				transparent: true
			})
		);
		crosshair.position.z = - 2;
		camera.add(crosshair);


		scene.add(new THREE.HemisphereLight(0x606060, 0x404040));


		var light = new THREE.DirectionalLight(0xffffff);
		light.position.set(4, 3, 3).normalize();
		scene.add(light);
		
		

		
		var geometry = new THREE.BoxGeometry(8, 6, 6);

		var loader = new THREE.TextureLoader();

		var textureW = loader.load('pic/wallpaper.jpg');
		textureW.wrapS = THREE.RepeatWrapping;
		textureW.wrapT = THREE.RepeatWrapping;
		textureW.repeat.set(8, 8);

		var textureF = loader.load('pic/floor.jpg');
		textureF.wrapS = THREE.RepeatWrapping;
		textureF.wrapT = THREE.RepeatWrapping;
		textureF.repeat.set(3, 2);

		var textureC = loader.load('pic/ceiling.jpg');
		textureC.wrapS = THREE.RepeatWrapping;
		textureC.wrapT = THREE.RepeatWrapping;
		textureC.repeat.set(3, 2);

		var materials = [
			new THREE.MeshBasicMaterial({map: textureW, side: THREE.BackSide}),
			new THREE.MeshBasicMaterial({map: textureW, side: THREE.BackSide}),
			new THREE.MeshBasicMaterial({map: textureC, side: THREE.BackSide}),
			new THREE.MeshBasicMaterial({map: textureF, side: THREE.BackSide}),
			new THREE.MeshBasicMaterial({map: textureW, side: THREE.BackSide}),
			new THREE.MeshBasicMaterial({map: textureW, side: THREE.BackSide}),
		];

		var room = new THREE.Mesh(geometry, materials);
		room.position.y = 3;
		scene.add(room);
		


		var loader = new THREE.GLTFLoader();
		
		// sofa
		loader.load('models/sofa.glb', function (gltf) {
			sofa = gltf.scene;
			sofa.scale.set(0.04, 0.04, 0.04);
			sofa.position.set(-2, 0, -3)
			sofa.rotation.y = - Math.PI / 2;
			scene.add(sofa);
		},
			function (xhr) { console.log((xhr.loaded / xhr.total * 100) + '% loaded'); },
			function (error) { console.log('An error happened'); }
		);
		
		// table
		loader.load('models/table.glb', function (gltf) {
			table = gltf.scene;
			table.scale.set(0.03, 0.03, 0.03);
			table.position.set(2.5, 0, 2.5)
			table.rotation.y = - Math.PI ;
			scene.add(table);
		},
			function (xhr) { console.log((xhr.loaded / xhr.total * 100) + '% loaded'); },
			function (error) { console.log('An error happened'); }
		);






		var loader = new THREE.TextureLoader();
		var picGeometry = new THREE.PlaneGeometry(1, 0.5);
		var picMaterial = new THREE.MeshLambertMaterial({map: loader.load('https://raw.githubusercontent.com/acossack/test/master/nastja.jpg'), side: THREE.DoubleSide});
		var pic = new THREE.Mesh( picGeometry, picMaterial );
		pic.rotation.y = -0.5 * Math.PI;
		pic.position.set(3.99, 1, 0);
		room.add(pic);

		var pic2 = new THREE.Mesh( picGeometry, picMaterial );
		pic2.position.set(0, 0, -2.99);
		room.add(pic2);


		var raycaster = new THREE.Raycaster();
		var renderer = new THREE.WebGLRenderer({ antialias: true });
		renderer.setPixelRatio(window.devicePixelRatio);
		renderer.setSize(window.innerWidth, window.innerHeight);
		renderer.vr.enabled = true;
		window.addEventListener('resize', onWindowResize, false);
		document.body.appendChild(renderer.domElement);
		document.body.appendChild(WEBVR.createButton(renderer));


		function onWindowResize() {
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
			renderer.setSize(window.innerWidth, window.innerHeight);
		}


		function animate() {
			renderer.setAnimationLoop(render);
			user.position.setZ(camera_z_pos);
			camera_z_pos -= current_velocity;
		}
		animate();

		var INTERSECTED;
		function render() {
			raycaster.setFromCamera({ x: 0, y: 0 }, camera);
			var intersects = raycaster.intersectObjects(room.children, true);
			if (intersects.length > 0) {
				if (INTERSECTED != intersects[0].object) {
					if (INTERSECTED) {INTERSECTED.scale.x = 1; INTERSECTED.scale.y = 1;}
					INTERSECTED = intersects[0].object;
					INTERSECTED.scale.x = 4;
					INTERSECTED.scale.y = 4;
				}
			} else {
				if (INTERSECTED) {INTERSECTED.scale.x = 1; INTERSECTED.scale.y = 1;}
				INTERSECTED = undefined;
			}

			renderer.render(scene, camera);
		}

	</script>
</body>

</html>
